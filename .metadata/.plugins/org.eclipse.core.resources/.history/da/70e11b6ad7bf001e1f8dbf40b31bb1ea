<!DOCTYPE html>
<html lang='ja'>

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/main.css">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/main.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.24.0/moment.min.js"></script>
  <script src="/webjars/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <!-- Bootstrap JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

  <!--flatpickr (미니 달력)-->
  <link rel="stylesheet" href="/webjars/flatpickr/4.6.13/dist/flatpickr.min.css">
  <script src="/webjars/flatpickr/4.6.13/dist/flatpickr.min.js"></script>
<!-- 위에는 webjars 이거는 cdn방식  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>-->
  <script src="/webjars/flatpickr/4.6.13/dist/l10n/ja.js"></script> <!-- 일본어 설정-->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>
  
  <!-- jQuery UI JS -->
	<script src="/webjars/jquery-ui/1.13.1/jquery-ui.js"></script>
	<!-- Datetimepicker CSS -->
	<link rel="stylesheet" href="/webjars/datetimepicker/2.5.20-1/jquery.datetimepicker.css">
	<!-- Datetimepicker JS -->
	<script src="/webjars/datetimepicker/2.5.20-1/jquery.datetimepicker.js"></script>

  <title>Insert title here</title>

  <style>
	body {
	  margin: 0;
	  padding: 0;
    }
    /* 전체 스타일 */
    .flexContainer {
	    display: flex;
	    padding-right: 0;
      padding-left: 0;
  	}
  	
  	/* 풀캘린더  */
    #calendar {
      width: 60%;
      
    }
    
    /* 일정추가 폼 */
    #calendarDetail {
		width: 20%;
    	height: 800px;
	}
	
	#eventTag {
		margin-top: 10px;
	}
	
	#flatpickr-container {
	    width: 21%; /* 또는 다른 원하는 크기로 조절 */
	    position: relative;
	    z-index: 1;
	}
	
	.flatpickr-calendar {
	    width: 100% ;
	}

	#flatpickr-container-start {
	    width: 21%; /* 또는 다른 원하는 크기로 조절 */
	    position: relative;
	    z-index: 1;
	}
	
	#timeInputs {
	  transition: opacity 0.5s ease; /* 변화에 트랜지션 적용 (선택 사항) */
	}
	
	#timeInputs.blurred {
	  opacity: 0.5; /* 음영 처리된 가시성 */
	  pointer-events: none; /* 이벤트 무시 (선택 사항) */
	}


  </style>

</head>

<body>
	<!--flatpickr-->
  	<div class="flexContainer">
	    <div id="flatpickr-container" class="calendarFlat">
	        <button id="todayButton" class="btn btn-dark">今日</button>
	        <input type="text" id="dateInput" placeholder="flatpickr 달력" style="display: none;">
	    </div>
	<div id='calendar'></div>
  

<!--fullcalendar-->
  <form id="" class="calendarFull">

  </form>
  
  
  <!--detail-->
      <div align="center" id="calendarDetail">
        <form action="" id="eventForm">
            <table>
				<h3 id="eventTag">이벤트</h3>
                <tr>
                    <td colspan="2">
                        <input type="text" id="title" class="form-control" placeholder="제목 및 시간 추가" onfocus="this.placeholder=''" onblur="this.placeholder='제목 및 시간 추가'" size="27px">
                    </td>
                </tr>
<!--                <tr>-->
<!--                    <td>-->
<!--                        <button class="btn btn-primary">이벤트</button>&nbsp;-->
<!--                        <button class="btn btn-primary">할 일</button>-->
<!--                    </td>-->
<!--                </tr>-->
                <tr>
					<td id="flatpickr-container-start">
						시작일 : <input type="text" id="startDate" class="form-control">
						종료일 : <input type="text" id="endDate" class="form-control">
					</td>
				</tr>
				<tr id="timeInputs">
					<td>
				        시작시간 :
				        <select id="startTime" class="form-control">
				        </select>
				        종료시간 :
				        <select id="endTime" class="form-control" style="color: white; background-color: black;">
				        </select>
					</td>
				</tr>
				<tr>
					<td>
	                    종일 : <input type="checkbox" id="allDay" name="allDay">
					</td>
                </tr>
                <tr>
					<td>
	                    장소 <input id="place" name="place" class="form-control">
					</td>
                </tr>
                <tr>
                    <td>
                        <select id="repeat" class="form-select" aria-label="Default select example">
                            <option value="1">반복안함</option>
                            <option value="2">매일</option>
                            <option value="3">매주</option>
                            <option value="4">평일</option>
                            <option value="5">주말</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <textarea id="content" class="form-control" placeholder="설명 추가" onfocus="this.placeholder=''" onblur="this.placeholder='설명 추가'" cols="30" rows="10"></textarea>
                    </td>
                </tr>
<!--                <tr>-->
<!--                    <td>-->
<!--                        <select name="">-->
<!--                            <option value="">내 할 일 목록</option>-->
<!--                        </select>-->
<!--                    </td>-->
<!--                </tr>-->
                <tr>
					<td colspan="2" align="right">
						<button onclick="insertPlan()" class="btn btn-primary">저장</button>
					</td>
				</tr>
            </table>
        </form>
    </div>
    </div>
  

  <script>
	  
	 // 풀캘린더 api
    document.addEventListener('DOMContentLoaded', function () {
		
      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth', // 처음 실행시 월별달력으로 실행
        fixedWeekCount: false, // 달력 마지막주 까지만 출력되게
        editable: true,
        
        headerToolbar: {
          left: 'prevYear,prev,next,nextYear today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        
        buttonText: {
	        today: '今日',
	        month: '月',
	        week: '週',
	        day: '日',
	        list: '目錄'
	      },
		locale: 'ja',
        selectable: true,


        dateClick: function (info) {
          // info 객체에 선택된 날짜의 정보가 담겨 있음
          console.log(info);
        }
      });
      
      calendar.render();
      

      // 일정추가 
      $('#eventForm').submit(function (e) {
        e.preventDefault();
        
        var title = $('#title').val();
        var startDate = $('#startDate').val();
        var endDate = $('#endDate').val();
        var startTime = $('#startTime').val();
        var endTime = $('#endTime').val();
        var content = $('#content').val();
        var repeatOption = $('#repeat').val();

        console.log(title);
        console.log(startDate);
        console.log(endDate);
        console.log(startTime);
        console.log(endTime);

        if (title) {
          calendar.addEvent({
            title: title,
            start: startDate,
            end: endDate,
          });
        }
      });


	  // flatpickr api 
      const dateInput = document.getElementById('dateInput');
      const startDateInput = document.getElementById('startDate');
	  const endDateInput = document.getElementById('endDate');

      function handleDateChange(selectedDates, dateStr, instance) {
        console.log('선택된 날짜:', dateStr);
        // 선택된 날짜를 fullcalendar에 전달
        calendar.gotoDate(moment(dateStr).format('YYYY-MM-DD'));
      }
      
      
      // todayButton 버튼 클릭 시 Flatpickr 날짜 갱신(좌상단 flatpickr 버튼)
	  document.getElementById('todayButton').addEventListener('click', function () {
	    const today = new Date();
	    dateInput._flatpickr.setDate(today, true); // 미니달력 갱신
	    startDateInput._flatpickr.setDate(today, true); // 시작일 갱신
	    endDateInput._flatpickr.setDate(today, true); // 종료일 갱신
	
	    // FullCalendar에서 오늘 날짜로 이동
	    calendar.gotoDate(today);
	  });
	  
	  // FullCalendar 렌더링
    	calendar.render();

	// 좌상단 미니달력
      flatpickr(dateInput, {
		parent: document.getElementById('flatpickr-container'),
        inline: true,
        dateFormat: 'Y-m-d',
        enableTime: false,
        minDate: 'today',
        defaultDate: 'today',
        locale: 'ja',
        onChange: handleDateChange,  // 날짜 선택 이벤트 핸들러 등록
      }).open();
      
      // 일정추가 시작달력
      flatpickr("#startDate", {
		dateFormat: 'Y-m-d',
		enableTime: false,
		minDate: 'today',
		defaultDate: 'today',
		locale: 'ja',
		onChange: handleDateChange, // 날짜 선택 이벤트 핸들러 등록
		appendTo: document.getElementById('flatpickr-container-start')
	});

	// 일정추가 종료달력
	flatpickr("#endDate", {
		dateFormat: 'Y-m-d',
		enableTime: false,
		minDate: 'today',
		defaultDate: 'today',
		locale: 'ja',
		onChange: handleDateChange, // 날짜 선택 이벤트 핸들러 등록
		appendTo: document.getElementById('endDate').parentNode
		
	});
      
    });
  </script>
  
  <!-- ajax -->
    <script>
		function insertPlan() {
			// 폼에서 데이터 가져오기
		    var title = $('#title').val();
		    var startDate = $('#startDate').val();
		    var endDate = $('#endDate').val();
		    var startTime = $('#startTime').val();
		    var endTime = $('#endTime').val();
		    var content = $('#content').val();
		    var place = $('#place').val();
		    
			$.ajax({
				type:"post",
				url: "insert",
				data: {
					title: title,
					startDate: startDate,
					endDate: endDate,
					startTime: startTime,
					endTime: endTime,
					content: content,
					place: place
				},
				success: function (response) {
					console.log(response);
				},
				error: function (error) {
		            console.error('ajax 실패실패실패 :', error);
		        }
			})
		};
	</script>
	
	<!-- 종일체크시 시간 활성/비활성 -->
	<script>
		// 종일(all-day) 체크박스
		$('#allDay').change(function () {
		  if (this.checked) {
		    // 종일 체크되었을 때
		    $('#timeInputs').addClass('blurred');
		  } else {
		    // 종일 체크가 해제되었을 때
		    $('#timeInputs').removeClass('blurred');
		  }
		});
	</script>
	
	<!-- 시간설정 15분단위(24시간) -->
	<script>
	function populateTimeDropdown(selectElement) {
	    for (let hour = 0; hour < 24; hour++) {
	        for (let minute = 0; minute < 60; minute += 15) {
	            const formattedHour = hour.toString().padStart(2, '0');
	            const formattedMinute = minute.toString().padStart(2, '0');
	            const optionText = `${formattedHour}:${formattedMinute}`;
	            
	            const optionElement = document.createElement('option');
	            optionElement.value = optionText;
	            optionElement.textContent = optionText;
	            
	            selectElement.appendChild(optionElement);
	        }
	    }
	}
	
	// 시작 시간과 종료 시간 드롭다운을 채우기
	const startTimeDropdown = document.getElementById('startTime');
	const endTimeDropdown = document.getElementById('endTime');
	
	populateTimeDropdown(startTimeDropdown);
	populateTimeDropdown(endTimeDropdown);
	</script>
</body>
</html>
