<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/main.css">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/main.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.24.0/moment.min.js"></script>
  <script src="/webjars/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <!-- Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>
  
  <!-- jQuery UI JS -->
	<script src="/webjars/jquery-ui/1.13.1/jquery-ui.js"></script>
	<!-- Datetimepicker CSS -->
	<link rel="stylesheet" href="/webjars/datetimepicker/2.5.20-1/jquery.datetimepicker.css">
	<!-- Datetimepicker JS -->
	<script src="/webjars/datetimepicker/2.5.20-1/jquery.datetimepicker.js"></script>

  <title>Insert title here</title>

  <style>
	body {
	  margin: 0;
	  padding: 0;
    }
    .flexContainer {
	    display: flex;
	    padding-right: 0;
      padding-left: 0;
  	}
    #calendar {
      width: 60%;
      
    }
    #calendarDetail {
		width: 20%;
    	height: 800px;
	}

    #timeSelectionModal {
      width: 400px;
      /* 모달의 너비 조절 */
      margin-left: auto;
      margin-right: auto;
    }

  </style>

</head>

<body>
	<!--flatpickr-->
  	<div class="flexContainer">
	    <div id="flatpickr-container" class="calendarFlat">
	        <button id="todayButton" class="btn btn-dark">Today</button>
	        <input type="text" id="dateInput" placeholder="종료 날짜" style="display: none;">
	    </div>
	<div id='calendar'></div>
  

<!--fullcalendar-->
  <form id="" class="calendarFull">

  </form>
  
  
  <!--detail-->
      <div align="center" id="calendarDetail">
        <form action="" id="eventForm">
            <table>
                <tr>
                    <td colspan="2">
                        <input type="text" class="form-control" placeholder="제목 및 시간 추가" onfocus="this.placeholder=''" onblur="this.placeholder='제목 및 시간 추가'" size="27px">
                    </td>
                </tr>
<!--                <tr>-->
<!--                    <td>-->
<!--                        <button class="btn btn-primary">이벤트</button>&nbsp;-->
<!--                        <button class="btn btn-primary">할 일</button>-->
<!--                    </td>-->
<!--                </tr>-->
                <tr>
					<td>
						시작일 : <input type="text" class="form-control" id="startDate" placeholder="시작 날짜"><br>
						종료일 : <input type="text" class="form-control" id="endDate" placeholder="종료 날짜">
					</td>
				</tr>
                <tr>
                    <td>날짜</td>
                </tr>
                <tr>
                    <td>
                        <select class="form-select" aria-label="Default select example">
                            <option value="1">반복안함</option>
                            <option value="2">매일</option>
                            <option value="3">매주</option>
                            <option value="4">평일</option>
                            <option value="5">주말</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <textarea name="" class="form-control" placeholder="설명 추가" onfocus="this.placeholder=''" onblur="this.placeholder='설명 추가'" cols="30" rows="10"></textarea>
                    </td>
                </tr>
                <tr>
                    <td>
                        <select name="">
                            <option value="">내 할 일 목록</option>
                        </select>
                    </td>
                </tr>
                <tr>
					<td colspan="2" align="right">
						<button onclick="insertPlan()" class="btn btn-primary" id="eventBtn">저장</button>
					</td>
				</tr>
            </table>
        </form>
    </div>
    </div>
  

  <script>
	  
	 // 풀캘린더 api
    document.addEventListener('DOMContentLoaded', function () {
      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth', // 처음 실행시 월별달력으로 실행
        fixedWeekCount: false, // 달력 마지막주 까지만 출력되게
        editable: true,

        headerToolbar: {
          left: 'prevYear,prev,next,nextYear today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },


        selectable: true,
  


        dateClick: function (info) {
          // info 객체에 선택된 날짜의 정보가 담겨 있음
          console.log(info);
        }
      });
      
      calendar.render();
      

      // 일정추가 
      $('#eventForm').submit(function (e) {
        e.preventDefault();
        
        var eventName = $('#eventName').val();
        var startDate = $('#startDate').val();
        var endDate = $('#endDate').val();
        var startTime = $('#startTime').val();
        var endTime = $('#endTime').val();
        var eventMemo = $('#eventMemo').val();
        var repeatOption = $('#repeatOption').val();

        console.log(eventName);
        console.log(startTime);
        console.log(endTime);

        if (eventName) {
          calendar.addEvent({
            title: eventName,
            start: moment(startTime, 'HH:mm'),
            end: moment(endTime, 'HH:mm'),
            extendedProps: {
              memo: eventMemo,
              repeatOption: repeatOption
            }
          });

          //calendar.unselect(); // 선택 해제
          $('#timeSelectionModal').modal('hide');
        }
      });


	  // flatpickr api 
      const dateInput = document.getElementById('dateInput');
      const startDateInput = document.getElementById('startDate');
	  const endDateInput = document.getElementById('endDate');

      function handleDateChange(selectedDates, dateStr, instance) {
        console.log('선택된 날짜:', dateStr);
        // 선택된 날짜를 fullcalendar에 전달
        calendar.gotoDate(moment(dateStr).format('YYYY-MM-DD'));
      }
      
      
      // todayButton 버튼 클릭 시 Flatpickr 날짜 갱신(좌상단 flatpickr 버튼)
	  document.getElementById('todayButton').addEventListener('click', function () {
	    const today = new Date();
	    dateInput._flatpickr.setDate(today, true); // 미니달력 갱신
	    startDateInput._flatpickr.setDate(today, true); // 시작일 갱신
	    endDateInput._flatpickr.setDate(today, true); // 종료일 갱신
	
	    // FullCalendar에서 오늘 날짜로 이동
	    calendar.gotoDate(today);
	  });
	  
	  // FullCalendar 렌더링
    	calendar.render();

	// 좌상단 미니달력
      flatpickr(dateInput, {
        inline: true,
        dateFormat: 'Y-m-d',
        enableTime: false,
        minDate: 'today',
        defaultDate: 'today',
        locale: 'ko',
        onChange: handleDateChange,  // 날짜 선택 이벤트 핸들러 등록
      }).open();
      
      // 일정등록 시작달력
      flatpickr(startDateInput, {
		dateFormat: 'Y-m-d',
		enableTime: false,
		minDate: 'today',
		defaultDate: 'today',
		locale: 'ko',
		onChange: handleDateChange, // 날짜 선택 이벤트 핸들러 등록
	});

	// 일정등록 종료달력
	flatpickr(endDateInput, {
		dateFormat: 'Y-m-d',
		enableTime: false,
		minDate: 'today',
		defaultDate: 'today',
		locale: 'ko',
		onChange: handleDateChange, // 날짜 선택 이벤트 핸들러 등록
	});
      
    });
  </script>
</body>

</html>
